---
layout: post
title: 总结从去年年底开始学习使用.Net Core的经历和展望
subtitle: 主要是总结一下自己的心路历程以及以后学习的方向
date: 2018-05-24
author: Dunbreak
header-img: img/post-bg-greatdesign.jpg
catalog: true
tags:
    - .Net Core
    - C#
    - 总结
---

# 开始
在去年年底，因为业务变更需要将旧的项目移植一部分到新的项目中，全新的站点。由于公司内部逐步在向Java转型，这也是国内各个.Net公司都在干的事，内部的很多Windows平台的资源都逐步废弃，比如SqlServer和Windows服务器都无法申新了。实属无奈新的项目只能使用Linux以及MySql，这时候总监给出了两种解决方案：1、直接使用Java重写，舍弃.Net；2、找出更好的解决方案。因为我自己真的不是很喜欢写Java，可以说自己被C#优美的语法糖以及VS强大的功能养废了，所以我申请新项目使用.Net Core开发。也正是那个时候，.Net Core 2.0刚发布了3-4个月，一切都是新的，那不如直接开始边学边用。

因为是我申请的，所以这项工作基本就落在了我一个人身上，新的项目搭建一共就两个人，我负责.Net Core站点的整体运行，另一个同事负责前端样式迁移。这项工作对我这么一个刚工作两年半的小码农来说真的是一项挑战，压力很大。但是组内对我的支持很是很足的，因为我当时几乎没使用过Linux，对Linux的理解完全停留在VMWare装装虚拟机操作操作界面的程度，所以组里提供了一台电脑，专门装成Linux提供给我学习。毕竟大家都是.Net程序员出身，迫于无奈转型Java，但是本身还是对.Net有着一份热爱的，不想让它就这么被抛弃了（笑）

## 学习
刚开始完全就是一个学习的阶段，组里给了我两天的时间学习，让我在两天内在提供的测试Linux服务器上运行起来.Net Core的程序，至少得有个Hello World吧。我从微软官方文档的 [.Net Core指南](https://docs.microsoft.com/zh-cn/dotnet/core/)开始看起，但是这篇文档对刚开始学习的人不是很友好，内部大多.Net CLI以及部署迁移的讲解看的我实在头疼，其实我只想找一个站点怎么启动，对于我这种没有用过Owin的人Startup到底是啥，怎么在Linux运行等问题，所以之后找到了这篇资料 [ASP.NET Core 中文文档目录](http://www.cnblogs.com/dotNETCoreSG/p/aspnetcore-index.html) ，这篇文档我几乎看完了里面写的所有中文翻译的内容，对我的帮助很大，但是很可惜的是作者们没有继续更新，很多想看的章节他们都不再继续写了，并且有些地方用到的是.Net Core 1.0的资料，和2.0有些许不同。但，这已经足够我创建一个Demo项目了。
![](http://f.cl.ly/items/1y2F3p2Q312h1Y0b3X0x/%E5%AD%A6%E4%B9%A0%E6%B3%A8%E9%87%8A2.png)
![当时的学习注释，到现在都还留着](http://f.cl.ly/items/1y233N2P300p0m180M2I/%E5%AD%A6%E4%B9%A0%E6%B3%A8%E9%87%8A.png)

很快，带着学习注释的Demo项目就写完了，发布之后传去了Linux服务器，等着看Hello World的我却失望了。在当时还傻傻的打着 `dotnet run` 的我，项目完全运行不起来，缺少各种依赖项，没办法当时不太懂，所以每次都是直接把源文件全部传到Linux上，然后在Linux生成运行。磕磕绊绊，最终Hello World还是展示在了Linux的Firefox上，很高兴！

## 进阶
机缘巧合，在某个.Net的学习群里看到了有人在强烈推荐 [Jesse](http://www.jessetalk.cn/) 的视频，抱着试试看的心态点进去看了几节他的 [ASP.NET Core快速入门](http://video.jessetalk.cn/my/course/4) （当时还是免费的）瞬间被吸引了，然后想都没想直接买了他的付费课程。从这时候开始，我每天上下班地铁上、公司开发休息的时候干的事，就是看他的视频学习。当时的我感觉像是抱住了一颗救命稻草一样如获至宝，因为没有他的视频，我的学习进度非常慢，根本赶不上项目的预期，做不好有可能就会直接被Java替换。功夫不负有心人，很快我就看完了他的所有基础课程，并且可供开发的Demo项目也已经写得差不多了，通过了组长的评审，确认项目可以在.Net Core下开发。自此，项目基本进入了正式开发阶段。

# 开发
由于项目一半以上的逻辑都被微服务替代了，所以开发阶段其实就是枯燥的业务逻辑代码迁移。但是在进行团队项目迁移之前，还需要解决几个问题，因为有了这些底层的东西整个项目才能算是运转起来。

## 权限系统重写
新项目需要和其他集团实现SSO，并且.Net Core下的权限系统已经和Framework版本大不相同。但是当时的需求还没有明确，不知道这个权限系统数据源究竟是我们自己获取还是通过微服务拆分。在技术API还不太会使用，业务逻辑又在不停地变的时候这真是一个非常棘手的问题了，我还记得很清楚为了这个问题周六日加了两天班。

具体的内容我已经写在新的帖子中了：[.Net Core项目摸索学习（一）](http://www.dunbreak.cn/2018/05/28/.Net-Core%E9%A1%B9%E7%9B%AE%E6%91%B8%E7%B4%A2%E5%AD%A6%E4%B9%A0-%E4%B8%80/)

## Dapper服务封装
一个站点里不能没有持久化的工具，新站点里使用了和老项目一样的StackExchange.Dapper，轻量快速好用支持.Net Core而没有使用EF Core，因为使用EF Core团队内需要一些学习成本，但是项目进度紧张并没有这个时间。其实也正是这个原因导致了权限系统没有使用Asp.Net Identity。

对Dapper的服务化封装其实也耗费了很大的精力，期间也有不少次改版，也有自己能力太差碰到的不少坑，具体的内容我写在了新的帖子中：[.Net Core项目摸索学习（二）](http://www.dunbreak.cn/)

## 微服务调用服务
项目里一大半的逻辑已经使用微服务替换，因此就需要一个微服务的调用服务来调用微服务，做到日志监控、统一管理等功能，这样光写一个GET/POST的请求方法肯定是不行的。况且，微服务目前的提供方式都是HTTP的RESTful接口，并没有RPC的相关内容，所以如何能更加优雅地请求和获取响应是我想实现的目标，因此有了这篇新帖子里写的内容：[.Net Core项目摸索学习（三）](http://www.dunbreak.cn/)

## 零碎的问题
解决了以上的几个问题，按理说就可以提供给团队进行开发了。但是开发过程中还会碰到一些零碎的小问题，比如Action中的 `string` 类型默认值由 `""` 变成了 `null`，这样原来的有些代码就会出现判断失误、生成的视图中源代码的编码问题、配置文件配置等问题，我全部总结到了：[.Net Core项目摸索学习（四）](http://www.dunbreak.cn/)

解决了以上问题之后，站点的“底层”也算是开发完毕了，项目也就正式进入了开发阶段。其实这真的不能算真正的“底层”，又尤其看完 [ABP项目](http://aspnetboilerplate.com/) 架构师搭建的代码之后我更是觉得无地自容，觉得我的这些东西就是个玩具。但是没办法，当前的水平有限最多只能做到站点的正常运行，期待以后能不断进阶不断完善。

# 部署
项目搭建完就需要部署在Linux上了。说真的，在学习.Net Core之前我甚至不知道整个项目是如何部署的，Framework版本的项目，写完之后FTP传到win服务器之后，IIS就会自动重启看到效果了，对服务器几乎是一无所知。唉，这其实也是被.Net平台养废的一个迹象吧。但是很幸运，我有了这次开发.Net Core项目的机会，也开始接触学习Linux系统，开始学习项目部署，以及之后的Docker等。

公司的正式服务器全都是运行在CentOS下的，但是至此之前的版本都是6.5，为了使用.Net Core组里专门申请几台CentOS7的服务器作为正式环境使用。第一次使用SSH连上服务器可以说我是懵逼的，完全不知道自己该干什么，内部的测试服务器由于装了UI，所以操作起来还算便利，但是对着黑屏幕的命令行我还是第一次。所以没办法学习了一点 [Linux基础操作命令](https://blog.csdn.net/u010187139/article/details/40859147)。

所有的项目部署我都是根据这篇[将ASP.NET Core应用程序部署至生产环境中（CentOS7）](https://www.cnblogs.com/ants/p/5732337.html)来完成的，至今我有新的Supervisor的配置问题还在看这个帖子来解决。

# 写在最后
项目总算赶上进度磕磕绊绊地上线了。是的，我承认项目还存在很多大问题大漏洞，整个项目没有单元测试框架、没有日志监控、没有报错预警、没有持续集成……这些问题都需要我不断学习不断完善和优化。我能有这么一次机会是非常幸运的，从开始学习.Net Core项目到最终成功的部署上线，这两个月我成长了很多，学到了很多，这些经验是财富。之后我也不断地学习，学习了Docker的操作，了解了持续集成的额概念，知道了.Net Core搭建微服务的原理和逻辑。这些都是我日后需要自己动手学习研究并且在项目中实践的东西。

但是和这些财富比起来我觉得我得到的更多的是突然又有了努力学习的方向和动力。作为.Net平台的拥护者，在码农的圈子里一直处于鄙视链的最底层，在其他大众眼里我可能就是一个搬砖的民工，每天干着重复的事没有未来……而.Net Core的出现给我了新的学习的目标，感谢微软拥抱开源，我会继续不断学习的。
